# AntiPlagiat — система проверки работ на плагиат

**Кратко:** минималистичная демонстрационная микросервисная система для проверки студенческих работ на схожесть (плагиат) с генерацией отчётов.

---

## Содержание

* [Архитектура](#архитектура)
* [Как это работает](#как-это-работает)
* [Алгоритм определения плагиата](#алгоритм-определения-плагиата)
* [Облако слов](#облако-слов)
* [Требования для запуска](#требования-для-запуска)
* [Запуск системы](#запуск-системы)
* [API Endpoints](#api-endpoints)
* [Как пользоваться веб-интерфейсом](#как-пользоваться-веб-интерфейсом)
* [Примеры использования через терминал](#примеры-использования-через-терминал)
* [Формат отчёта (пример)](#формат-отчёта)
* [Пример результата проверки](#пример-результата-проверки)
* [Технические особенности](#технические-особенности)

---

## Архитектура

Система состоит из трёх микросервисов:

* **API Gateway** — единая точка входа, веб-интерфейс. Порт `:8000`
* **File Storing Service** — хранение файлов и метаданных. Порт `:8001`
* **File Analysis Service** — извлечение текста, сравнение, генерация отчётов. Порт `:8002`

---

## Как это работает

1. Студент загружает работу через веб-интерфейс (форма на сайте).
2. API Gateway принимает файл и отправляет его в File Storing Service.
3. File Storing Service сохраняет файл и вычисляет его хэш (SHA-256).
4. API Gateway инициирует анализ в File Analysis Service.
5. File Analysis Service извлекает текст и сравнивает его со всеми ранее загруженными работами.
6. Генерируется отчёт с процентом схожести и ссылкой на облако слов.
7. Отчёт доступен в формате JSON и через веб-страницу.

---

## Алгоритм определения плагиата

Комбинированный многоуровневый подход:

1. **Извлечение текста** — поддерживаются `.txt`, `.pdf`, `.docx`.
2. **Методы сравнения:**

   * `difflib.SequenceMatcher` — сравнение последовательностей символов.
   * Сравнение по уникальным словам — пересечение множеств слов.
   * Сравнение по шинглам — совпадения последовательностей из 3 слов.
3. **Вычисление процента схожести** — среднее значение по трём методам.
4. **Интерпретация результата:**

   * `0–30%` — низкая схожесть (плагиата нет)
   * `30–70%` — средняя схожесть (возможно заимствование)
   * `70–100%` — высокая схожесть (плагиат)

---

## Облако слов

Для текстовых файлов генерируется облако слов через QuickChart API — URL облака возвращается в поле `word_cloud_url` отчёта.

---

## Требования для запуска

* Docker
* Docker Compose

---

## Запуск системы

1. Убедитесь, что Docker и Docker Compose установлены и Docker запущен.
2. Склонируйте репозиторий или поместите проект в папку.
3. В корне проекта выполните:

```bash
docker-compose up --build
```

4. Откройте в браузере: `http://localhost:8000`

При запуске поднимутся 3 контейнера:

* `api-gateway` (порт 8000)
* `file-storing` (порт 8001)
* `file-analysis` (порт 8002)

---

## API Endpoints

**Через API Gateway**

* `POST /upload` — загрузка работы
* `GET /works/{id}/report` — получение отчёта в формате JSON
* `GET /report/{id}` — веб-страница с отчётом
* `GET /` — веб-интерфейс для загрузки файлов
* `GET /health` — проверка статуса системы

**Прямые запросы к микросервисам**

* File Storing: `GET http://localhost:8001/works` — список всех работ
* File Analysis: `POST http://localhost:8002/analyze` — запуск анализа

---

## Как пользоваться веб-интерфейсом

1. Откройте `http://localhost:8000`.
2. Заполните форму:

   * **ФИО студента** (например, `Иванов Иван Иванович`)
   * **ID задания** (например, `hw_1`)
   * **Файл работы** (`.txt`, `.pdf`, `.docx`)
3. Нажмите **Загрузить**.
4. Система выдаст ID работы и ссылку на отчёт.

---

## Примеры использования через терминал

**Загрузка файла**

```bash
curl -X POST "http://localhost:8000/upload" \
  -F "file=@работа.txt" \
  -F "student_name=Иванов Иван" \
  -F "assignment_id=homework_1"
```

**Получение отчёта в формате JSON**

```bash
curl "http://localhost:8000/works/1/report"
```

**Красивое форматирование JSON**

```bash
curl http://localhost:8000/works/1/report | python3 -m json.tool
```


---

## Формат отчёта

```json
{
  "id": 1,
  "work_id": 1,
  "student_name": "Иванов Иван",
  "assignment_id": "homework_1",
  "file_name": "работа.txt",
  "is_plagiarism": false,
  "plagiarism_score": 0.35,
  "original_author": null,
  "matched_work_id": null,
  "matched_file_name": null,
  "similarity_percentage": 35.0,
  "word_cloud_url": "https://quickchart.io/wordcloud?data=...",
  "file_hash": "31f713423ed90fb48e865569f03c5fad...",
  "created_at": "2025-12-10T19:00:48.442188"
}
```

---

## Пример результата проверки

* **Уникальная работа:** схожесть `< 30%` — плагиат не обнаружен
* **Частичное совпадение:** схожесть `30–70%` — рекомендуется ручная проверка преподавателем
* **Плагиат:** схожесть `> 70%` — работа помечается как плагиат

---

## Технические особенности

* **Поддерживаемые форматы файлов**

  * `.txt` — прямое чтение текста
  * `.pdf` — извлечение текста через `PyPDF2`
  * `.docx` — извлечение текста через `python-docx`

* **Алгоритм сравнения текстов**

  * `difflib.SequenceMatcher`
  * Сравнение по уникальным словам
  * Шинглы

* **Порог плагиата**
  По умолчанию: `70%` (выше — помечается как плагиат)

* **Хранение данных:** In-memory (для демонстрации)

* **Язык:** Python 3.13

* **Фреймворк:** FastAPI

---

