<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AntiPlagiat - –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>üì§ AntiPlagiat System</h1>
        <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç –Ω–∞ –ø–ª–∞–≥–∏–∞—Ç</p>

        <div class="upload-form">
            <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞–±–æ—Ç—É</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="student_name">–§–ò–û —Å—Ç—É–¥–µ–Ω—Ç–∞:</label>
                    <input type="text" id="student_name" name="student_name" required
                           placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                </div>

                <div class="form-group">
                    <label for="assignment_id">–ó–∞–¥–∞–Ω–∏–µ:</label>
                    <input type="text" id="assignment_id" name="assignment_id" required
                           placeholder="homework_1, lab_2, exam_2024">
                </div>

                <div class="form-group">
                    <label for="file">–§–∞–π–ª —Ä–∞–±–æ—Ç—ã:</label>
                    <input type="file" id="file" name="file" accept=".txt,.pdf,.docx" required>
                    <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .txt, .pdf, .docx</small>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    <span id="btnText">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</span>
                    <div id="spinner" class="spinner" style="display: none;"></div>
                </button>
            </form>

            <div id="message"></div>
        </div>

        <div class="instructions">
            <h3>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞:</h3>
            <ol>
                <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å —Ä–∞–±–æ—Ç–æ–π —Å—Ç—É–¥–µ–Ω—Ç–∞</li>
                <li>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –µ–≥–æ –Ω–∞ –ø–ª–∞–≥–∏–∞—Ç</li>
                <li>–í—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç —Å –æ–±–ª–∞–∫–æ–º —Å–ª–æ–≤</li>
                <li>–ü–ª–∞–≥–∏–∞—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ –ø–æ–ª–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é —Ñ–∞–π–ª–æ–≤</li>
            </ol>
        </div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const messageDiv = document.getElementById('message');
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
            btnText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
            spinner.style.display = 'inline-block';
            submitBtn.disabled = true;

            messageDiv.innerHTML = '<div class="loading">‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...</div>';

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();

                    messageDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!
                            <p>ID —Ä–∞–±–æ—Ç—ã: <strong>${result.work_id}</strong></p>
                            <p>–°—Ç–∞—Ç—É—Å: <strong>${result.status}</strong></p>
                            <p>
                                <a href="/works/${result.work_id}/view" class="btn" target="_blank">
                                    üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç
                                </a>
                            </p>
                        </div>
                    `;

                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('uploadForm').reset();

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Ç—á–µ—Ç —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        window.open(`/works/${result.work_id}/view`, '_blank');
                    }, 2000);

                } else {
                    const error = await response.json();
                    messageDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>`;
                }
            } catch (error) {
                messageDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                btnText.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É';
                spinner.style.display = 'none';
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>